â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸŒ WINDI i18n AUDIT - STRATO
Date: Thu Jan 29 02:48:21 AM CET 2026

=== 1. HARDCODED PT STRINGS ===
/opt/windi/a4desk-editor/a4desk_babel.py:48:            "pt": {"lang_name": "PortuguÃªs", "flag": "ğŸ‡§ğŸ‡·", "principle": "IA processa. Humano decide. WINDI garante.", "new_doc": "+ Novo Documento", "title": "Novo Documento", "start": "Comece a escrever...", "author": "Autor", "date": "Data", "reviewer": "Revisor", "save": "Salvar", "finalize": "Finalizar", "draft": "Rascunho", "validated": "Validado", "governance": "GovernanÃ§a WINDI", "human_only": "Somente humano", "status": "Status", "created": "Criado", "saved": "Salvo", "receipt_gen": "WINDI-RECEIPT gerado!", "detected": "Detectado"}
/opt/windi/a4desk-editor/a4desk_tiptap_babel.py:141:    "pt": {"lang_name": "PortuguÃªs", "flag": "ğŸ‡§ğŸ‡·", "principle": "IA processa. Humano decide. WINDI garante.", "new_doc": "+ Novo Documento", "title": "Novo Documento", "start": "Comece a escrever...", "author": "Autor", "date": "Data", "reviewer": "Revisor", "save": "Salvar", "finalize": "Finalizar", "draft": "Rascunho", "validated": "Validado", "finalized": "Finalizado", "governance": "GovernanÃ§a WINDI", "human_only": "Somente humano", "status": "Status", "created": "Criado", "saved": "Salvo", "receipt_gen": "WINDI-RECEIPT gerado!", "delete": "Apagar", "to_chat": "Voltar ao Chat", "confirm_delete": "Apagar este documento?"},
/opt/windi/a4desk-editor/a4desk_tiptap_babel.py:142:    "es": {"lang_name": "EspaÃ±ol", "flag": "ğŸ‡ªğŸ‡¸", "principle": "IA procesa. Humano decide. WINDI garantiza.", "new_doc": "+ Nuevo Documento", "title": "Nuevo Documento", "start": "Empiece a escribir...", "author": "Autor", "date": "Fecha", "reviewer": "Revisor", "save": "Guardar", "finalize": "Finalizar", "draft": "Borrador", "validated": "Validado", "finalized": "Finalizado", "governance": "Gobernanza WINDI", "human_only": "Solo humano", "status": "Estado", "created": "Creado", "saved": "Guardado", "receipt_gen": "WINDI-RECEIPT generado!", "delete": "Eliminar", "to_chat": "Volver al Chat", "confirm_delete": "Â¿Eliminar este documento?"},
/opt/windi/a4desk-editor/a4desk_tiptap_babel.py:144:    "it": {"lang_name": "Italiano", "flag": "ğŸ‡®ğŸ‡¹", "principle": "L'IA elabora. L'umano decide. WINDI garantisce.", "new_doc": "+ Nuovo Documento", "title": "Nuovo Documento", "start": "Inizia a scrivere...", "author": "Autore", "date": "Data", "reviewer": "Revisore", "save": "Salva", "finalize": "Finalizza", "draft": "Bozza", "validated": "Validato", "finalized": "Finalizzato", "governance": "Governance WINDI", "human_only": "Solo umano", "status": "Stato", "created": "Creato", "saved": "Salvato", "receipt_gen": "WINDI-RECEIPT generato!", "delete": "Elimina", "to_chat": "Torna alla Chat", "confirm_delete": "Eliminare questo documento?"},
/opt/windi/a4desk-editor/a4desk_tiptap_babel.py:476:    """Enviar mensagem para o WINDI Agent via Gateway - com suporte a Bescheid"""
/opt/windi/a4desk-editor/a4desk_tiptap_babel.py:514:        # Salvar PDF
/opt/windi/a4desk-editor/a4desk_tiptap_babel.py:1033:                        <button class="chat-send-doc" onclick="sendDocToChat()" title="Enviar documento para revisÃ£o">
/opt/windi/a4desk-editor/a4desk_tiptap_babel.py:1037:                            <i class="fas fa-paper-plane"></i> Enviar
/opt/windi/a4desk-editor/a4desk_tiptap_babel.py:1124:        new_doc: '+ Novo Documento', title: 'Novo Documento', start: 'Comece a escrever...',
/opt/windi/a4desk-editor/a4desk_tiptap_babel.py:1125:        author: 'Autor', date: 'Data', reviewer: 'Revisor', save: 'Salvar', finalize: 'Finalizar',
/opt/windi/a4desk-editor/a4desk_editor.py:20:            violations.append("G1: Documento vazio")
/opt/windi/a4desk-editor/a4desk_editor.py:45:        "title": (request.json or {}).get("title", "Novo Documento"),
/opt/windi/a4desk-editor/a4desk_editor.py:125:<button class="btn btn-new" onclick="newDoc()">+ Novo Documento</button>
/opt/windi/a4desk-editor/a4desk_editor.py:128:<input class="title" id="title" value="Novo Documento" placeholder="Titulo">
/opt/windi/a4desk-editor/a4desk_editor.py:137:<button class="btn btn-save" onclick="saveDoc()">ğŸ’¾ Salvar</button>
/opt/windi/a4desk-editor/a4desk_editor.py:144:const r=await fetch('/api/document',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({title:'Novo Documento'})});
/opt/windi/a4desk-editor/a4desk_babel.STABLE.py:48:            "pt": {"lang_name": "PortuguÃªs", "flag": "ğŸ‡§ğŸ‡·", "principle": "IA processa. Humano decide. WINDI garante.", "new_doc": "+ Novo Documento", "title": "Novo Documento", "start": "Comece a escrever...", "author": "Autor", "date": "Data", "reviewer": "Revisor", "save": "Salvar", "finalize": "Finalizar", "draft": "Rascunho", "validated": "Validado", "governance": "GovernanÃ§a WINDI", "human_only": "Somente humano", "status": "Status", "created": "Criado", "saved": "Salvo", "receipt_gen": "WINDI-RECEIPT gerado!", "detected": "Detectado"}
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:48:            "pt": {"lang_name": "PortuguÃªs", "flag": "ğŸ‡§ğŸ‡·", "principle": "IA processa. Humano decide. WINDI garante.", "new_doc": "+ Novo Documento", "title": "Novo Documento", "start": "Comece a escrever...", "author": "Autor", "date": "Data", "reviewer": "Revisor", "save": "Salvar", "finalize": "Finalizar", "draft": "Rascunho", "validated": "Validado", "governance": "GovernanÃ§a WINDI", "human_only": "Somente humano", "status": "Status", "created": "Criado", "saved": "Salvo", "receipt_gen": "WINDI-RECEIPT gerado!", "detected": "Detectado"}
/opt/windi/a4desk-editor/a4desk_i18n.py:37:    "title": {Lang.EN: "New Document", Lang.DE: "Neues Dokument", Lang.PT: "Novo Documento"},
/opt/windi/a4desk-editor/a4desk_i18n.py:42:    "save": {Lang.EN: "Save", Lang.DE: "Speichern", Lang.PT: "Salvar"},
/opt/windi/a4desk-editor/a4desk_i18n.py:53:    "created": {Lang.EN: "Document created", Lang.DE: "Dokument erstellt", Lang.PT: "Documento criado"},
/opt/windi/a4desk-editor/a4desk_i18n.py:233:pt:{principle:"IA processa. Humano decide. WINDI garante.",newDoc:"+ Novo Documento",title:"Novo Documento",start:"Comece a escrever...",author:"Autor",date:"Data",reviewer:"Revisor",save:"ğŸ’¾ Salvar",finalize:"âœ… Finalizar",draft:"Rascunho",validated:"Validado âœ“",governance:"ğŸ›¡ï¸ GovernanÃ§a WINDI",human:"ğŸ”’ Somente humano",created:"Documento criado",saved:"Salvo!",receipt:"WINDI-RECEIPT gerado!",detected:"Detectado"}
/opt/windi/a4desk-editor/a4desk_babel.STABLE_2026-01-25_2157.py:48:            "pt": {"lang_name": "PortuguÃªs", "flag": "ğŸ‡§ğŸ‡·", "principle": "IA processa. Humano decide. WINDI garante.", "new_doc": "+ Novo Documento", "title": "Novo Documento", "start": "Comece a escrever...", "author": "Autor", "date": "Data", "reviewer": "Revisor", "save": "Salvar", "finalize": "Finalizar", "draft": "Rascunho", "validated": "Validado", "governance": "GovernanÃ§a WINDI", "human_only": "Somente humano", "status": "Status", "created": "Criado", "saved": "Salvo", "receipt_gen": "WINDI-RECEIPT gerado!", "detected": "Detectado"}

=== 2. i18n FILES ===
-rw-r--r-- 1 windi windi 15955 Jan 25 08:56 /opt/windi/a4desk-editor/a4desk_i18n.py

=== 3. LANGUAGE DETECTION ===
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:46:            "en": {"lang_name": "English", "flag": "ğŸ‡¬ğŸ‡§", "principle": "AI processes. Human decides. WINDI guarantees.", "new_doc": "+ New Document", "title": "New Document", "start": "Start writing...", "author": "Author", "date": "Date", "reviewer": "Reviewer", "save": "Save", "finalize": "Finalize", "draft": "Draft", "validated": "Validated", "governance": "WINDI Governance", "human_only": "Human only", "status": "Status", "created": "Created", "saved": "Saved", "receipt_gen": "WINDI-RECEIPT generated!", "detected": "Detected"},
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:47:            "de": {"lang_name": "Deutsch", "flag": "ğŸ‡©ğŸ‡ª", "principle": "KI verarbeitet. Der Mensch entscheidet. WINDI garantiert.", "new_doc": "+ Neues Dokument", "title": "Neues Dokument", "start": "Beginnen Sie zu schreiben...", "author": "Autor", "date": "Datum", "reviewer": "PrÃ¼fer", "save": "Speichern", "finalize": "AbschlieÃŸen", "draft": "Entwurf", "validated": "Validiert", "governance": "WINDI Governance", "human_only": "Nur Mensch", "status": "Status", "created": "Erstellt", "saved": "Gespeichert", "receipt_gen": "WINDI-RECEIPT erstellt!", "detected": "Erkannt"},
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:48:            "pt": {"lang_name": "PortuguÃªs", "flag": "ğŸ‡§ğŸ‡·", "principle": "IA processa. Humano decide. WINDI garante.", "new_doc": "+ Novo Documento", "title": "Novo Documento", "start": "Comece a escrever...", "author": "Autor", "date": "Data", "reviewer": "Revisor", "save": "Salvar", "finalize": "Finalizar", "draft": "Rascunho", "validated": "Validado", "governance": "GovernanÃ§a WINDI", "human_only": "Somente humano", "status": "Status", "created": "Criado", "saved": "Salvo", "receipt_gen": "WINDI-RECEIPT gerado!", "detected": "Detectado"}
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:53:def get_langs():
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:56:def t(key, lang):
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:57:    langs = get_langs()
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:58:    return langs.get(lang, {}).get(key) or TRANSLATIONS.get('en', {}).get(key, key)
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:60:def detect_browser_lang(accept_lang):
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:61:    if not accept_lang: return 'en'
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:62:    for part in accept_lang.split(','):
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:64:        if code in get_langs(): return code
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:67:def detect_text_lang(text):
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:75:    scores = {lang: sum(1 for p in pats if p in words) for lang, pats in patterns.items()}
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:94:def apply_g6(text, lang):
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:95:    for old, new in G6_PATTERNS.get(lang, []):
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:99:def make_receipt(doc_id, content, guardrails, lang):
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:105:        "guardrails": guardrails, "language": lang,
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:106:        "lang_name": t("lang_name", lang), "principle": t("principle", lang),
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:112:    return jsonify({"status": "healthy", "service": "A4 Desk BABEL", "languages": list(get_langs().keys())})
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:114:@app.route('/api/languages')
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:115:def languages():
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:116:    return jsonify({code: {"name": data.get("lang_name", code), "flag": data.get("flag", "ğŸŒ")} for code, data in get_langs().items()})
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:125:    lang = detect_text_lang(text) or 'en'
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:126:    return jsonify({"language": lang, "name": t("lang_name", lang), "flag": get_langs().get(lang, {}).get("flag", "ğŸŒ")})
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:131:    lang = data.get("lang", detect_browser_lang(request.headers.get('Accept-Language')))
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:133:    doc = {"id": doc_id, "title": t("title", lang), "content": {"text": ""}, "human_fields": {}, "status": "draft", "language": lang, "created_at": datetime.now(timezone.utc).isoformat()}
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:135:    register_event("DOCUMENT_CREATED", {"document_id": doc_id, "language": lang})
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:136:    return jsonify({"document": doc, "message": t("created", lang)}), 201
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:147:    lang = data.get("lang", doc.get("language", "en"))
/opt/windi/a4desk-editor/a4desk_babel.PRE_PATCH_2026-01-25_2216.py:150:    text = apply_g6(text, lang)

=== 4. HTML TEMPLATES ===

=== 5. CURRENT i18n STRUCTURE (first 150 lines) ===
#!/usr/bin/env python3
"""
A4 Desk Editor - Multilingual Edition
WINDI Publishing House - Torre de Babel Revertida
DE | EN | PT
"""
import os, json, hashlib, re
from datetime import datetime, timezone
from flask import Flask, request, jsonify, render_template_string
from flask_cors import CORS
from enum import Enum

app = Flask(__name__)
CORS(app)
DOCUMENTS = {}

class Lang(Enum):
    DE = "de"
    EN = "en"
    PT = "pt"

# DetecÃ§Ã£o de idioma
PATTERNS = {
    Lang.DE: ['ich', 'sie', 'ist', 'und', 'der', 'die', 'das', 'nicht', 'bitte', 'danke', 'guten', 'dokument', 'hilfe'],
    Lang.PT: ['eu', 'vocÃª', 'voce', 'nÃ£o', 'nao', 'sim', 'como', 'para', 'obrigado', 'olÃ¡', 'documento', 'ajuda'],
    Lang.EN: ['the', 'is', 'are', 'have', 'has', 'please', 'thank', 'yes', 'no', 'help', 'document', 'need']
}

def detect_lang(text):
    if not text: return Lang.EN
    words = set(re.findall(r'\b\w+\b', text.lower()))
    scores = {lang: sum(1 for p in pats if p in words) for lang, pats in PATTERNS.items()}
    return max(scores, key=scores.get) if max(scores.values()) > 0 else Lang.EN

# TraduÃ§Ãµes
T = {
    "title": {Lang.EN: "New Document", Lang.DE: "Neues Dokument", Lang.PT: "Novo Documento"},
    "start": {Lang.EN: "Start writing...", Lang.DE: "Beginnen Sie zu schreiben...", Lang.PT: "Comece a escrever..."},
    "author": {Lang.EN: "Author", Lang.DE: "Autor", Lang.PT: "Autor"},
    "date": {Lang.EN: "Date", Lang.DE: "Datum", Lang.PT: "Data"},
    "reviewer": {Lang.EN: "Reviewer", Lang.DE: "PrÃ¼fer", Lang.PT: "Revisor"},
    "save": {Lang.EN: "Save", Lang.DE: "Speichern", Lang.PT: "Salvar"},
    "finalize": {Lang.EN: "Finalize", Lang.DE: "AbschlieÃŸen", Lang.PT: "Finalizar"},
    "draft": {Lang.EN: "Draft", Lang.DE: "Entwurf", Lang.PT: "Rascunho"},
    "validated": {Lang.EN: "Validated", Lang.DE: "Validiert", Lang.PT: "Validado"},
    "governance": {Lang.EN: "WINDI Governance", Lang.DE: "WINDI Governance", Lang.PT: "GovernanÃ§a WINDI"},
    "principle": {
        Lang.EN: "AI processes. Human decides. WINDI guarantees.",
        Lang.DE: "KI verarbeitet. Der Mensch entscheidet. WINDI garantiert.",
        Lang.PT: "IA processa. Humano decide. WINDI garante."
    },
    "human_only": {Lang.EN: "Human only", Lang.DE: "Nur Mensch", Lang.PT: "Somente humano"},
    "created": {Lang.EN: "Document created", Lang.DE: "Dokument erstellt", Lang.PT: "Documento criado"},
    "saved": {Lang.EN: "Saved and validated", Lang.DE: "Gespeichert und validiert", Lang.PT: "Salvo e validado"},
    "receipt_generated": {Lang.EN: "WINDI-RECEIPT generated!", Lang.DE: "WINDI-RECEIPT erstellt!", Lang.PT: "WINDI-RECEIPT gerado!"},
    "empty_error": {Lang.EN: "Empty content not allowed", Lang.DE: "Leerer Inhalt nicht erlaubt", Lang.PT: "ConteÃºdo vazio nÃ£o permitido"},
    "select_lang": {Lang.EN: "Language", Lang.DE: "Sprache", Lang.PT: "Idioma"}
}

def t(key, lang): return T.get(key, {}).get(lang, T.get(key, {}).get(Lang.EN, key))

# G6 Filter multilÃ­ngue
G6 = {
    Lang.EN: [("You should ", "Consider: "), ("I recommend ", "Option: "), ("You must ", "Consider: ")],
    Lang.DE: [("Sie sollten ", "ErwÃ¤gen Sie: "), ("Ich empfehle ", "Option: "), ("Sie mÃ¼ssen ", "ErwÃ¤gen Sie: ")],
    Lang.PT: [("VocÃª deve ", "Considere: "), ("Recomendo ", "OpÃ§Ã£o: "), ("VocÃª precisa ", "Considere: ")]
}

def apply_g6(text, lang):
    for old, new in G6.get(lang, G6[Lang.EN]):
        text = text.replace(old, new)
    return text

class Guardrails:
    @staticmethod
    def apply(content, lang):
        text = content.get("text", "")
        violations = []
        guardrails = ["G1", "G2", "G6"]
        if not text.strip():
            violations.append(t("empty_error", lang))
        text = apply_g6(text, lang)
        if violations:
            guardrails.append("G7-BLOCKED")
        return text, guardrails, violations

def make_receipt(doc_id, content, guardrails, lang):
    ts = datetime.now(timezone.utc)
    h = hashlib.sha256(json.dumps(content).encode()).hexdigest()[:12]
    return {
        "receipt_id": f"WINDI-A4DESK-{ts.strftime('%d%b%y').upper()}-{h.upper()}",
        "document_id": doc_id,
        "timestamp": ts.isoformat(),
        "hash": h,
        "guardrails": guardrails,
        "language": lang.value,
        "principle": t("principle", lang)
    }

@app.route('/api/health')
def health():
    return jsonify({"status": "healthy", "service": "A4 Desk Editor i18n", "languages": ["de", "en", "pt"]})

@app.route('/api/document', methods=['POST'])
def create_doc():
    data = request.json or {}
    lang = Lang(data.get("lang", "en"))
    doc_id = f"DOC-{datetime.now().strftime('%Y%m%d%H%M%S')}"
    doc = {
        "id": doc_id,
        "title": t("title", lang),
        "content": {"type": "doc", "text": ""},
        "human_fields": {},
        "status": "draft",
        "language": lang.value,
        "created_at": datetime.now(timezone.utc).isoformat()
    }
    DOCUMENTS[doc_id] = doc
    return jsonify({"document": doc, "message": t("created", lang)}), 201

@app.route('/api/document/<doc_id>', methods=['GET'])
def get_doc(doc_id):
    if doc_id not in DOCUMENTS:
        return jsonify({"error": "Not found"}), 404
    return jsonify(DOCUMENTS[doc_id])

@app.route('/api/document/<doc_id>', methods=['PUT'])
def update_doc(doc_id):
    if doc_id not in DOCUMENTS:
        return jsonify({"error": "Not found"}), 404
    data = request.json
    doc = DOCUMENTS[doc_id]
    text = data.get("content", {}).get("text", "")
    lang = Lang(data.get("lang", doc.get("language", "en")))
    filtered_text, guardrails, violations = Guardrails.apply({"text": text}, lang)
    if violations:
        return jsonify({"error": violations[0], "violations": violations}), 400
    doc["content"] = {"type": "doc", "text": filtered_text}
    doc["human_fields"] = data.get("human_fields", {})
    doc["language"] = lang.value
    doc["updated_at"] = datetime.now(timezone.utc).isoformat()
    return jsonify({"document": doc, "guardrails": guardrails, "message": t("saved", lang)})

@app.route('/api/document/<doc_id>/finalize', methods=['POST'])
def finalize_doc(doc_id):
    if doc_id not in DOCUMENTS:
        return jsonify({"error": "Not found"}), 404
    doc = DOCUMENTS[doc_id]
    lang = Lang(doc.get("language", "en"))
    text = doc.get("content", {}).get("text", "")
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
